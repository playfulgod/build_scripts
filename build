#!/bin/bash

# This script is to make my life easier when building AOKP kangs. It  #
# will build for all the One V devices, but can be modified for       #
# others.                                                             #
# If you want to use this build script you will need to change quite  #
# A few things, including the DIR, sync -jx, device name, upload url, #
# etc. Have fun building!                                             #

HOME=~/android/aokpjb

# Starting Timer for build
start() {
START=$(date +%s)
}

# Clean out old builds
cd $HOME
. build/envsetup.sh
clear

sync() {
echo -n "would you like to sync yourself? (y/n)? "
read que

if [ "$que" == "y" ]; then
repo sync -j10
else
echo "you better be sure"
fi
}

clean(){
echo -n "would you like to clean yourself? (y/n)? "
read que

if [ "$que" == "y" ]; then
make clobber && make clean
rm -rf out
else
echo "you better be sure"
fi
}

# Cherries
primo() {
cd $HOME
cd vendor/htc
git fetch http://gerrit.sudoservers.com/AOKP/vendor_htc refs/changes/97/3797/7 && git cherry-pick FETCH_HEAD
cd ../aokp
git fetch http://gerrit.sudoservers.com/AOKP/vendor_aokp refs/changes/77/3777/6 && git cherry-pick FETCH_HEAD
cd $HOME
}

triumph() {
cd $HOME
cd vendor/aokp
git fetch https://github.com/rukin5197/vendor_aokp refs/heads/jb && git cherry-pick e8d205d044d1b6332ac05bae290fedf98025e6af
cd $HOME
}

VideoCamera() {
cd $HOME
cd frameworks/av
git fetch https://github.com/jmztaylor/android_frameworks_av/
git cherry-pick f04c3e9b806340da53832a70a448a5bacb191df1
cd $HOME
cd hardware/qcom/media
git fetch https://github.com/jmztaylor/android_hardware_qcom_media-1/
git cherry-pick b5a22a09fb55217d0184febc5d7fb0b270b5d901
cd $HOME
}

# Uploads
uploadprimoc() {
find . -name *aokp_\*unofficial*.zip -printf %p\\n -exec scp {} gannon5197@upload.goo.im:public_html/aokp/primoc/nightlies/ \:
ssh gannon5197@upload.goo.im chmod 755 -R public_html/ \:
rm update_*
}

uploadprimou() {
find . -name *aokp_\*unofficial*.zip -printf %p\\n -exec scp {} gannon5197@upload.goo.im:public_html/aokp/primou/nightlies/ \:
ssh gannon5197@upload.goo.im chmod 755 -R public_html/ \:
rm update_*
}

uploadtriumph() {
find . -name *aokp_\*unofficial*.zip -printf %p\\n -exec scp {} gannon5197@upload.goo.im:public_html/aokp/triumph/nightlies/ \:
ssh gannon5197@upload.goo.im chmod 755 -R public_html/ \:
rm update_*
}

# Hacks
hacktriumph() {
device/motorola/triumph/releasetools/triumph_ota_from_target_files -v \
	   -p out/host/linux-x86 \
	   -k build/target/product/security/testkey \
           --backup=false \
	   --override_device=triumph,WX435,fb0 \
	   out/target/product/triumph/obj/PACKAGING/target_files_intermediates/aokp_triumph-target_files-eng.gannon5197.zip out/target/product/triumph/aokp_triumph-ota-eng.gannon5197.zip && ./vendor/aokp/tools/squisher
}

end() {
END=$(date +%s)
ELAPSED=$((END - START))
E_MIN=$((ELAPSED / 60))
E_SEC=$((ELAPSED - E_MIN * 60))
printf "Elapsed: "
[ $E_MIN != 0 ] && printf "%d min(s) " $E_MIN
printf "%d sec(s)\n" $E_SEC
}

while :
do
clear
echo " Which Device you building today?"
echo "1. PrimoC"
echo "2. PrimoU"
echo "3. Triumph"
echo "4. Exit"
echo -n "Please enter option [1 - 4]"
read opt
case $opt in
1) echo "************* Building PrimoC *************";
sync;
clean;
start;
primo;
VideoCamera;
brunch primoc 2>&1 | tee aokp_primoc.log;
uploadprimoc;
end;
pause;;
2) echo "************* Building PrimoU *************";
sync;
clean;
start;
primo;
VideoCamera;
brunch primou 2>&1 | tee aokp_primou.log;
uploadprimou;
end;
pause;;
3) echo "************* Building Triumph *************";
sync;
clean;
start;
brunch triumph 2>&1 | tee aokp_triumph.log;
hacktriumph;
uploadtriumph;
end;
pause;;
4) echo "Bye!"
exit 1;;
*) echo "$opt is an invaild option. Please select option between 1-4 only";
echo "Press [enter] key to continue. . .";
read enterKey;;
esac
done
