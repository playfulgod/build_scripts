#!/bin/bash

# This script is to make my life easier when building AOKP kangs. It  #
# will build for all the One V devices, but can be modified for       #
# others.                                                             #
# If you want to use this build script you will need to change quite  #
# A few things, including the DIR, sync -jx, device name, upload url, #
# etc. Have fun building!                                             #

HOME=~/android/cm10

# Starting Timer for build
start() {
START=$(date +%s)
}

# Clean out old builds
cd $HOME
. build/envsetup.sh
clear

sync() {
echo -n "would you like to sync yourself? (y/n)? "
read que

if [ "$que" == "y" ]; then
repo sync -j10
else
echo "you better be sure"
fi
}

clean(){
echo -n "would you like to clean yourself? (y/n)? "
read que

if [ "$que" == "y" ]; then
make clobber && make clean
rm -rf out
else
echo "you better be sure"
fi
}

# Cherries
ril() {
cd $HOME
cd frameworks/base
git fetch https://github.com/MTCM10/android_frameworks_base refs/heads/jellybean && git cherry-pick 573db959d74e14b41f914bcb62baba1f36bc5baa
cd $HOME
}

headset() {
cd $HOME
cd frameworks/base
git fetch https://github.com/MTCM10/android_frameworks_base refs/heads/jellybean && git cherry-pick 20f7bbc8d6130fb23b63f6c0164792ef7cc3a462
cd $HOME
}

wifi() {
cd $HOME
cd hardware/libhardware_legacy
git fetch https://github.com/MTCM10/android_hardware_libhardware_legacy refs/heads/jellybean && git cherry-pick 17f3e967e57f0b52a43497444e1b29e618fbb3ab
cd $HOME
}

hack() {
device/motorola/triumph/releasetools/triumph_ota_from_target_files -v \
	   -p out/host/linux-x86 \
	   -k build/target/product/security/testkey \
           --backup=false \
	   --override_device=triumph,WX435,fb0 \
	   out/target/product/triumph/obj/PACKAGING/target_files_intermediates/cm_triumph-target_files-eng.rukin5197.zip out/target/product/triumph/cm_triumph-ota-eng.rukin5197.zip && ./vendor/cm/tools/squisher
}

# Dieting
diets() {
cd $HOME
cd frameworks/base
git cherry-pick 06d3bb994047885651d52392b40e250832318821
git cherry-pick 14dfbaf378dcaf38845f77c6a6cbd2f87700613a
git cherry-pick 09ed05db81d06cb14d70f2583b46d9788ff418e0
git cherry-pick 8218bc598279957534375b8df4db9307ff5327af
cd $HOME
cd build
git fetch https://github.com/MTCM10/android_build refs/heads/jellybean
git cherry-pick a82c9eb91a7f07500f75cf6dbe38e1ec1e384876
cd $HOME
cd packages/apps/Trebuchet
git fetch https://github.com/MTCM10/android_packages_apps_Trebuchet refs/heads/jellybean
git cherry-pick b97740613d1003db51d88115ed2a35651084b729
cd $HOME
cd external/svox
git fetch https://github.com/MTCM10/android_external_svox refs/heads/jellybean
git cherry-pick e06b991cc5b3406074e3081f5544873e6060cab9
cd $HOME
}

# Uploads
upload() {
cd $HOME
cd out/target/product/triumph
scp -P 2222 cm-10-*.zip gannon5197@upload.goo.im:~/public_html/cm10/triumph/nightlies/
}

end() {
END=$(date +%s)
ELAPSED=$((END - START))
E_MIN=$((ELAPSED / 60))
E_SEC=$((ELAPSED - E_MIN * 60))
printf "Elapsed: "
[ $E_MIN != 0 ] && printf "%d min(s) " $E_MIN
printf "%d sec(s)\n" $E_SEC
}

while :
do
clear
sync;
clean;
start;
ril;
headset;
wifi;
diets 2>&1 | tee diets.log;
brunch triumph 2>&1 | tee cm_triumph.log;
hack;
upload;
end;
done
